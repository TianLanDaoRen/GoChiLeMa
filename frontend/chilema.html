<!DOCTYPE html>
<html lang="zh-cn" class="bg-base-300">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8">
    <title>吃了吗</title>
    <script type="text/javascript" src="js/frame-bar.js"></script>
</head>

<body>
    <article class="prose">
        <div class="flex flex-col lg:flex-row px-3">
            <div class="grid grid-cols-1 w-full content-around">
                <div class="text-primary text-xl text-center items-center justify-center flex">
                    <span class="font-bold justify-center">吃了吗</span>
                    <span>
                        <i class="fa fa-utensils"></i>
                    </span>
                    <span class="divider divider-horizontal"></span>
                    <div class="grid grid-rows-auto grid-flow-dense">
                        <span class="text-secondary font-bold">基于马尔科夫预测法</span>
                        <span class="text-secondary font-bold">记录数据越多推荐越精准</span>
                    </div>
                </div>
                </br>
                <div class="text-secondary text-lg text-center">
                    <i class="fa fa-quote-left fa-pull-left fa-border" aria-hidden="true"></i>
                    <span>颐，贞吉。观颐，自求口实。</span>
                    </br>
                    <span>《象》曰：山下有雷，颐。君子以慎言语，节饮食。</span>
                    <i class="fa fa-quote-right fa-pull-right fa-border" aria-hidden="true"></i>
                </div>
                </br>
                <!-- list of buttons here -->
                <div class="flex flex-col gap-2">
                    <button class="btn btn-base-100 btn-lg text-lg" onclick="onRecordData()">
                        <span>记录数据</span>
                        <span>
                            <i class="fa fa-pencil-square fa-fw"></i>
                        </span>
                    </button>
                    <button class="btn btn-base-100 btn-lg text-lg" onclick="onEditData()">
                        <span>查看记录</span>
                        <span>
                            <i class="fa fa-list-alt fa-fw"></i>
                        </span>
                    </button>
                    <button class="btn btn-base-100 btn-lg text-lg" onclick="onRecommend()">
                        <span>推荐餐品</span>
                        <span>
                            <i class="fa fa-cutlery fa-fw"></i>
                        </span>
                    </button>
                </div>
            </div>
            <div class="divider lg:divider-horizontal"></div>
            <div class="grid grid-cols-1 w-full flex-auto content-around">
                <div class="function-area">
                    <h1 class="text-secondary text-center text-xl">
                        <span>
                            <i class="fa fa-hand-o-left fa-fw fa-lg"></i>
                        </span>
                        <span class="font-bold">在左侧选择功能以开始</span>
                    </h1>
                </div>

                <div class="record-data function-area text-center content-around hidden">
                    <h1 class="text-secondary text-xl">
                        <span class="font-bold">记录数据</span>
                        <span>
                            <i class="fa fa-pencil-square fa-fw"></i>
                        </span>
                    </h1>
                    <div class="divider"></div>
                    <form class="record-form" autocomplete="off" onsubmit="onSubmitRecord()">
                        <div class="grid grid-rows-1 grid-flow-col-dense gap-1">
                            <label class="form-control">
                                <div class="label">
                                    <span class="label-text">年</span>
                                    <span class="label-text-alt">
                                        日期
                                        <i class="fa fa-calendar fa-fw"></i>
                                    </span>
                                </div>
                                <select class="select select-bordered" id="year" name="year">
                                </select>
                            </label>
                            <label class="form-control">
                                <div class="label">
                                    <span class="label-text">月</span>
                                    <span class="label-text-alt">
                                        请选择
                                        <i class="fa fa-arrow-down fa-fw"></i>
                                    </span>
                                </div>
                                <select class="select select-bordered" id="month" name="month">
                                </select>
                            </label>
                            <label class="form-control">
                                <div class="label">
                                    <span class="label-text">日</span>
                                    <span class="label-text-alt">
                                        请选择
                                        <i class="fa fa-arrow-down fa-fw"></i>
                                    </span>
                                </div>
                                <select class="select select-bordered" id="day" name="day">
                                </select>
                            </label>
                        </div></br>
                        <div class="grid grid-rows-1 grid-flow-col-dense gap-1">
                            <label class="form-control">
                                <div class="label">
                                    <span class="label-text">吃的啥？</span>
                                    <span class="label-text-alt">
                                        例如：蒸羊羔
                                        <i class="fa fa-coffee fa-fw"></i>
                                    </span>
                                </div>
                                <input type="text" name="food" placeholder="在此输入" class="input input-bordered" />
                            </label>
                            <label class="form-control pt-1">
                                <div class="label">
                                    <span class="label-text"></span>
                                    <span class="label-text-alt">
                                        点此提交
                                        <i class="fa fa-share fa-fw"></i>
                                    </span>
                                </div>
                                <button type="submit" class="btn btn-outline">
                                    提交数据
                                </button>
                            </label>
                        </div>
                    </form>
                </div>

                <div class="edit-data function-area hidden">
                    <h1 class="text-secondary text-center text-xl">
                        <span class="font-bold">查看数据</span>
                        <span>
                            <i class="fa fa-list-alt fa-fw"></i>
                        </span>
                    </h1>
                </div>

                <div class="recommend function-area hidden">
                    <h1 class="text-secondary text-center text-xl">
                        <span class="font-bold">推荐餐品</span>
                        <span>
                            <i class="fa fa-cutlery fa-fw"></i>
                        </span>
                    </h1>
                </div>
            </div>
        </div>
    </article>
</body>
<script>
    function onRecordData() {
        // Unhide the record data div
        unhide('record-data');
        // Set year\month\day selet options
        let yearOptions = document.querySelector('#year');
        let monthOptions = document.querySelector('#month');
        let dayOptions = document.querySelector('#day');
        for (let i = 2000; i <= 2050; i++) {
            let option = document.createElement('option');
            option.value = i;
            option.innerText = i + '年';
            yearOptions.appendChild(option);
        }
        for (let i = 1; i <= 12; i++) {
            let option = document.createElement('option');
            option.value = i;
            option.innerText = i + '月';
            monthOptions.appendChild(option);
        }
        for (let i = 1; i <= 31; i++) {
            let option = document.createElement('option');
            option.value = i;
            option.innerText = i + '日';
            dayOptions.appendChild(option);
        }
        // Get current date year、month、day
        let date = new Date();
        let year = date.getFullYear();
        let month = date.getMonth() + 1;
        let day = date.getDate();
        // Set year、month、day
        document.querySelector('#year').value = year;
        document.querySelector('#month').value = month;
        document.querySelector('#day').value = day;
    }

    function onSubmitRecord() {
        console.log("onSubmitRecord");
        event.preventDefault();
        utils.getApiUrlAndBody("record").then((api) => {
            let api_url = api[0], body = api[1];
            // Add form serialize data to body
            let formData = new FormData(document.querySelector('.record-form'));
            for (let [key, value] of formData.entries()) {
                body[key] = value;
            }
            body = JSON.stringify(body);
            console.log(body);
            // Fetch data
            Fetch(api_url, "POST", body)
                .then(response => response.json())
                .then(data => {
                    // Retrieve email and vx
                    let email = data.email;
                    let vx = data.vx;
                    // Update email and vx
                    document.getElementById("emailInfo").innerText = email;
                    document.getElementById("vxInfo").innerText = vx;
                })
                .catch(error => {
                    console.error("Error:", error);
                });
        });
    }

    function onEditData() {
        // Unhide the record data div
        unhide('edit-data');
    }

    function onRecommend() {
        // Unhide the record data div
        unhide('recommend');
    }

    function unhide(className) {
        // Hide all function areas
        let functionAreas = document.querySelectorAll('.function-area');
        for (let i = 0; i < functionAreas.length; i++) {
            functionAreas[i].classList.add('hidden');
        }
        // Unhide the current one
        let element = document.querySelector('.' + className);
        element.classList.remove('hidden');
    }
</script>

</html>